from __future__ import annotations

from typing import Any, Dict


UI_STRINGS: Dict[str, Dict[str, Any]] = {
        "en": {
                "app_help": "Warframe Market analytics without tears.",
                "progress": {
                        "stages": {"scan": "Scanning prime sets", "calc": "Calculating prices"},
                        "format": "[{label}] {done}/{total} • {remaining_label} {remaining}",
                        "done_format": "[{label}] {done}/{total} • {status_done}",
                        "remaining_label": "Remaining",
                        "remaining_less": "less than a second",
                        "remaining_seconds": "{seconds:.1f} s",
                        "status_done": "done",
                },
                "saved": "Saved: {out}",
                "no_results": "Nothing suitable was found.",
                "open_label": "Open",
                "sheet_title_template": "{title} — Warframe Market Profit Overview",
                "empty_sheet": "No data",
                "headers": [
                        "Open",
                        "Warframe Market ID",
                        "Item name",
                        "24h volume",
                        "Average price (24h)",
                        "Live price (top-{n})",
                        "Deviation",
                        "Sum of parts (24h)",
                        "Sum of parts (top-{n})",
                        "Difference (24h)",
                        "Difference % (24h)",
                        "Difference (top-{n})",
                        "Difference % (top-{n})",
                ],
                "notes": [
                        "Use the Warframe Market ID filter \"_set\" to jump to a set quickly.",
                        "The average price (24h) comes from the Warframe Market statistics for the last 24 hours.",
                        "The live price averages the top-{n} current sell orders; the deviation is half of their spread.",
                        "Sum of parts is calculated with component quantities (24h statistics or the top-{n} orders).",
                        "Difference (24h) shows platinum: parts sum − set price. Positive values mean the parts are more expensive.",
                        "Difference % equals (parts sum / set price − 1).",
                ],
                "mods_headers": [
                        "Open",
                        "Warframe Market ID",
                        "Mod name",
                        "Rarity",
                        "Max rank",
                        "Endo to max",
                        "Unranked min",
                        "Unranked avg (top-{n})",
                        "Unranked deviation",
                        "Unranked orders",
                        "Maxed min",
                        "Maxed avg (top-{n})",
                        "Maxed deviation",
                        "Maxed orders",
                        "Price diff",
                        "Price diff %",
                        "Endo per platinum diff",
                        "Platinum per Endo",
                ],
                "mods_notes": [
                        "Unranked columns use sell orders with mod rank 0; maxed columns use the maximum mod rank available.",
                        "Deviation equals half of the spread between the cheapest and the priciest order within the top-{n} selection.",
                        "Endo per platinum diff shows how much Endo is required for each extra platinum earned by ranking the mod.",
                ],
                "mods_sheet_name": "mods",
                "mods_rarity_labels": {
                        "common": "Common",
                        "uncommon": "Uncommon",
                        "rare": "Rare",
                        "legendary": "Legendary",
                },
                "mods_progress": {
                        "label": "Mods",
                        "format": "[{label}] {done}/{total} • {name}",
                        "done_format": "[{label}] {done}/{total} • {status_done}",
                        "status_done": "done",
                },
                "category_titles": {
                        "warframes": "Warframes",
                        "primary": "Primary weapons",
                        "secondary": "Secondary weapons",
                        "melee": "Melee weapons",
                        "archwing": "Archwing & Space",
                        "companions": "Companions",
                        "other": "Other",
                },
                "endo_sheet_name": "endo",
                "errors": {
                        "live_price_top_n_positive": "live_price_top_n must be positive",
                },
                "gui": {
                        "title": "Warframe Market Toolkit",
                        "language_label": "Interface language",
                        "general_settings": "General settings",
                        "paths_settings": "Output files",
                        "sets_settings": "Prime set search",
                        "mods_settings": "Mod search",
                        "endo_settings": "Endo candidates",
                        "platform_label": "Platform",
                        "rate_delay_label": "Rate delay (seconds)",
                        "sets_output": "Prime sets report",
                        "mods_output": "Mod price report",
                        "endo_output": "Endo candidates report",
                        "all_output": "Combined report",
                        "only_online": "Only online sellers",
                        "filter_contains": "Name filter",
                        "filter_placeholder": "e.g. prime",
                        "limit_sets": "Maximum sets",
                        "limit_items": "Maximum items",
                        "limit_unlimited": "Unlimited",
                        "fetch_part_statistics": "Fetch part statistics",
                        "live_price_top_n": "Live price top-N",
                        "rarities": "Rarities",
                        "rarities_placeholder": "e.g. rare, legendary",
                        "min_mastery": "Min. mastery rank",
                        "min_mod_rank": "Min. mod rank",
                        "browse": "Browse…",
                        "generate_sets": "Generate sets report",
                        "generate_mods": "Generate mods report",
                        "generate_endo": "Generate Endo report",
                        "generate_all": "Generate all reports",
                        "progress_idle": "Idle",
                        "progress_working": "Working…",
                        "log_placeholder": "Messages will appear here.",
                        "status_saved": "Saved to {path}",
                        "status_error": "Error: {error}",
                        "dialog_title": "Select output file",
                        "success_all": "Combined report saved to {path}",
                        "success_sets": "Sets report saved to {path}",
                        "success_mods": "Mods report saved to {path}",
                        "success_endo": "Endo report saved to {path}",
                },
        },
        "ru": {
                "app_help": "Warframe Market аналитика без лишних слез.",
                "progress": {
                        "stages": {"scan": "Поиск прайм-наборов", "calc": "Расчёт цен"},
                        "format": "[{label}] {done}/{total} • {remaining_label} {remaining}",
                        "done_format": "[{label}] {done}/{total} • {status_done}",
                        "remaining_label": "Осталось",
                        "remaining_less": "меньше секунды",
                        "remaining_seconds": "{seconds:.1f} с",
                        "status_done": "готово",
                },
                "saved": "Сохранено: {out}",
                "no_results": "Ничего подходящего не найдено.",
                "open_label": "Открыть",
                "sheet_title_template": "{title} — аналитика Warframe Market",
                "empty_sheet": "Нет данных",
                "headers": [
                        "Открыть",
                        "Warframe Market ID",
                        "Название в игре",
                        "Объём продаж 24 часа",
                        "Средняя цена (24ч)",
                        "Реальная цена (топ-{n})",
                        "Погрешность",
                        "Сумма частей (24ч)",
                        "Сумма частей (топ-{n})",
                        "Разница (24ч)",
                        "Разница % (24ч)",
                        "Разница (топ-{n})",
                        "Разница % (топ-{n})",
                ],
                "notes": [
                        "Используйте фильтр Warframe Market ID \"_set\" для быстрого перехода к комплекту.",
                        "Средняя цена (24ч) берётся из статистики Warframe Market за последние 24 часа.",
                        "Реальная цена усредняется по топ-{n} актуальным ордерам; погрешность — половина разброса.",
                        "Сумма частей рассчитывается с учётом количества деталей (по статистике 24ч или по топ-{n} ордерам).",
                        "Разница (24ч) показана в платине: сумма деталей − цена комплекта (положительное значение ⇒ детали дороже).",
                        "Разница % вычисляется как (сумма деталей / цена комплекта − 1).",
                ],
                "mods_headers": [
                        "Открыть",
                        "Warframe Market ID",
                        "Название мода",
                        "Редкость",
                        "Макс. ранг",
                        "Эндо до максимума",
                        "Мин. цена (0 ранг)",
                        "Средняя цена (top-{n}, 0 ранг)",
                        "Отклонение (0 ранг)",
                        "Количество ордеров (0 ранг)",
                        "Мин. цена (макс. ранг)",
                        "Средняя цена (top-{n}, макс. ранг)",
                        "Отклонение (макс. ранг)",
                        "Количество ордеров (макс. ранг)",
                        "Разница в цене",
                        "Разница в цене %",
                        "Эндо / разница в платине",
                        "Платина / эндо",
                ],
                "mods_notes": [
                        "Столбцы для ранга 0 используют ордера с mod_rank = 0; столбцы для максимального ранга берут ордера с максимальным mod_rank.",
                        "Отклонение равняется половине разброса между минимальной и максимальной ценой внутри выборки top-{n}.",
                        "Эндо / разница в платине показывает, сколько эндо требуется для дополнительной платины после прокачки.",
                ],
                "mods_sheet_name": "моды",
                "mods_rarity_labels": {
                        "common": "Обычный",
                        "uncommon": "Необычный",
                        "rare": "Редкий",
                        "legendary": "Легендарный",
                },
                "mods_progress": {
                        "label": "Моды",
                        "format": "[{label}] {done}/{total} • {name}",
                        "done_format": "[{label}] {done}/{total} • {status_done}",
                        "status_done": "готово",
                },
                "category_titles": {
                        "warframes": "Варфреймы",
                        "primary": "Основное оружие",
                        "secondary": "Вторичное оружие",
                        "melee": "Ближнее оружие",
                        "archwing": "Арч и космос",
                        "companions": "Компаньоны",
                        "other": "Прочее",
                },
                "endo_sheet_name": "Эндо",
                "errors": {
                        "live_price_top_n_positive": "live_price_top_n должно быть положительным",
                },
                "gui": {
                        "title": "Warframe Market Toolkit",
                        "language_label": "Язык интерфейса",
                        "general_settings": "Общие настройки",
                        "paths_settings": "Файлы отчётов",
                        "sets_settings": "Поиск прайм-наборов",
                        "mods_settings": "Поиск модов",
                        "endo_settings": "Поиск эндо-кандидатов",
                        "platform_label": "Платформа",
                        "rate_delay_label": "Задержка запросов (сек)",
                        "sets_output": "Отчёт по наборам",
                        "mods_output": "Отчёт по модам",
                        "endo_output": "Отчёт по эндо",
                        "all_output": "Объединённый отчёт",
                        "only_online": "Только онлайн-продавцы",
                        "filter_contains": "Фильтр по названию",
                        "filter_placeholder": "например, prime",
                        "limit_sets": "Максимум наборов",
                        "limit_items": "Максимум предметов",
                        "limit_unlimited": "Без ограничений",
                        "fetch_part_statistics": "Загружать статистику деталей",
                        "live_price_top_n": "Топ-N для live цены",
                        "rarities": "Редкости",
                        "rarities_placeholder": "например: rare, legendary",
                        "min_mastery": "Мин. ранг мастерства",
                        "min_mod_rank": "Мин. ранг мода",
                        "browse": "Обзор…",
                        "generate_sets": "Сформировать отчёт по наборам",
                        "generate_mods": "Сформировать отчёт по модам",
                        "generate_endo": "Сформировать отчёт по эндо",
                        "generate_all": "Сформировать все отчёты",
                        "progress_idle": "Ожидание",
                        "progress_working": "Обработка…",
                        "log_placeholder": "Сообщения будут отображаться здесь.",
                        "status_saved": "Файл сохранён: {path}",
                        "status_error": "Ошибка: {error}",
                        "dialog_title": "Выбор файла",
                        "success_all": "Объединённый отчёт сохранён: {path}",
                        "success_sets": "Отчёт по наборам сохранён: {path}",
                        "success_mods": "Отчёт по модам сохранён: {path}",
                        "success_endo": "Отчёт по эндо сохранён: {path}",
                },
        },
}


_DEFAULT_LANGUAGE = "en"


def normalize_language(language: str | None) -> str:
        lang = (language or _DEFAULT_LANGUAGE).lower()
        if lang not in UI_STRINGS:
                return _DEFAULT_LANGUAGE
        return lang


def get_ui_strings(language: str | None) -> Dict[str, Any]:
        return UI_STRINGS[normalize_language(language)]


def available_languages() -> Dict[str, Dict[str, Any]]:
        return UI_STRINGS
