# wfmarket_tool

Маленький инструмент для выгрузки аналитики с Warframe Market:
1) Отчет «сеты vs части» с минимальными ценами и разницей в процентах.
2) Черновой поиск кандидатов для распыления ради эндо (дешевые высокоранговые моды/ривены).

## Установка
```bash
python -m venv .venv
. .venv/bin/activate  # Windows: .venv\\Scripts\\activate
pip install -r requirements.txt
```

## Быстрый старт
```bash
python cli.py sets --out warframe_market_sets.xlsx
python cli.py endo --out endo_candidates.xlsx
```

## Конфигурация
Все параметры CLI можно задать в `config.toml`. Значения из конфигурации используются как
значения по умолчанию и при необходимости легко переопределяются флагами командной строки.

- `platform` / `language` — общие настройки для всех команд (например, `platform = "pc"`, `language = "ru"`).
- `[limits].rate_delay` — задержка между запросами к API, помогает не получать 429.
- Блок `[sets]` — дефолты для отчета по прайм-наборам: файл выгрузки (`out`), фильтр (`filter_contains`),
  ограничение числа сетов (`limit_sets`, 0 или `null` отключает лимит), флаг `only_online`, показ прогресса,
  переключатель `fetch_part_statistics` (если выключить — отчет быстрее, но 24ч статистика для деталей не загружается)
  и `live_price_top_n` — сколько актуальных ордеров усредняется для «живой» цены.
- Блок `[endo]` — настройки поиска эндо-кандидатов: файл, фильтр по онлайн-продавцам,
  ограничения по MR/рангу и лимит числа анализируемых предметов.
- `[endo_table]` — опциональная таблица редкость/ранг → количество эндо для точного пересчета (по умолчанию заглушки).
- `[cache]` — управление файловым кешем ответов API (директория и TTL для статистики, ордеров и `item_full`; по умолчанию кеш в `./cache` рядом с приложением).

После правки `config.toml` ничего дополнительно запускать не нужно — обновленные значения подхватятся при следующем вызове `cli.py`.

Отчет по сетам (`cli.py sets`) включает:
- средние цены за 24 часа из статистики Warframe Market;
- «реальную» цену — среднее по четырём самым дешёвым активным ордерам и погрешность как половину разброса;
- сохранённые суммы деталей (24ч и топ-4) для оценки общей стоимости разборки;
- абсолютную и процентную разницу между комплектом и суммой деталей (по статистике и по живым ордерам);
- Excel разбит на отдельные листы по категориям (Варфреймы, Основное, Вторичное, Ближнее, Арч/космос, Компаньоны, Прочее).
- флаг `--skip-part-statistics` (или `fetch_part_statistics = false` в конфиге) ускоряет расчет,
  оставляя только «живые» цены для деталей и тем самым сокращая число запросов.

## Что внутри
- `wfmarket/api.py` — тонкий клиент к API warframe.market
- `wfmarket/analyzers/sets_vs_parts.py` — расчет выгоды "сеты против частей"
- `wfmarket/analyzers/riven_endo_hunt.py` — черновой поиск дешевых высокоранговых предметов
- `cli.py` — команды CLI через Typer
- `config.toml` — место для ваших настроек и таблицы пересчета в эндо

## Замечания
- Не долбите API чаще 3 запросов/сек. В коде есть задержка.
- Для точного расчета "цена за эндо" заполните `endo_table` в `config.toml` реальными цифрами.
- Этот инструмент ничего не продает и не покупает. Только читает публичный API.
