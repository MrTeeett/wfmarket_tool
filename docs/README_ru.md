# wfmarket_tool

Компактный инструмент для аналитики Warframe Market.

1. **Наборы против компонентов** — сравнивает стоимость полного сета и сумму его частей, учитывая «живые» ордера.
2. **Поиск кандидатов на Эндо** — находит моды и ривены, которые выгодно распылять на Эндо.
3. **Рентабельность прокачки модов** — сравнивает цены модов 0 ранга и максимального ранга с учётом стоимости Эндо.

## Установка

```bash
python -m venv .venv
. .venv/bin/activate  # Windows: .venv\Scripts\activate
pip install -r requirements.txt
```

## Быстрый старт

```bash
python cli.py sets --out warframe_market_sets.xlsx
python cli.py endo --out endo_candidates.xlsx
python cli.py mods --out mod_prices.xlsx
```

## Конфигурация

Все параметры CLI можно задать в `config.toml`; ключи командной строки имеют приоритет.

- `platform` / `language` — платформа и язык запросов к Warframe Market (например, `platform = "pc"`, `language = "ru"`).
- `ui_language` — язык сообщений CLI (`"en"` или `"ru"`).
- `[limits].rate_delay` — задержка между запросами, чтобы не получать 429.
- `[sets]` — настройки отчёта по наборам: файл (`out`), фильтр (`filter_contains`), ограничение по количеству (`limit_sets`), фильтр по статусу продавцов (`only_online`), прогресс, загрузка 24h-статистики (`fetch_part_statistics`) и размер окна для живых цен (`live_price_top_n`).
- `[endo]` — отчёт по кандидатам на Эндо: файл, фильтр по статусу продавцов, минимальные требования по мастерству/рангу и лимит проверяемых предметов.
- `[mods]` — сравнение цен модов: файл, фильтр по статусу продавцов, список редкостей (`rarities`), фильтр по названию, лимит предметов и `live_price_top_n` для усреднения цен.
- `[endo_table]` — при необходимости можно задать точные значения Эндо по редкости/рангу.
- `[cache]` — управление файловым кешем (каталог и время жизни для статистики, ордеров и `item_full`).

После изменения `config.toml` никаких дополнительных действий не требуется — настройки подхватываются при следующем запуске.

## Отчёт по наборам (`cli.py sets`)

- Берёт 24-часовые средние цены из статистики Warframe Market.
- Усредняет верхние N текущих ордеров, отображая половину спрэда как «отклонение».
- Предварительно считает сумму частей (статистика 24h или топ-N ордеров).
- Показывает абсолютную и процентную разницу между сетом и суммой частей.
- Выводит Excel с разбивкой по категориям (варфреймы, прайм-оружие, ближний бой и т.д.).
- Ключ `--skip-part-statistics` (или `fetch_part_statistics = false`) позволяет ускорить работу, оставив только «живые» цены.

## Рентабельность модов (`cli.py mods`)

- Сравнивает цену модов ранга 0 и максимального ранга, используя усреднение по топ-N ордерам.
- Рассчитывает стоимость Эндо до максимального ранга на основе формулы с редкостью.
- Показывает разницу в платине, процент прироста, а также метрики «Эндо за платину» и «Платина за Эндо» для оценки окупаемости.
- Поддерживает фильтрацию по редкости, подстроке в названии и статусу продавцов; результаты можно сохранить в CSV или Excel.

## Структура проекта

- `wfmarket/api.py` — клиент для API warframe.market.
- `wfmarket/analyzers/sets_vs_parts.py` — расчёт отчёта «наборы vs детали».
- `wfmarket/analyzers/riven_endo_hunt.py` — поиск модов/ривенов под распыление на Эндо.
- `wfmarket/analyzers/mods_price_tracker.py` — анализ цен модов и эффективности прокачки.
- `cli.py` — интерфейс командной строки на Typer.
- `config.toml` — пользовательские настройки и таблицы конверсии Эндо.

## Примечания

- Не злоупотребляйте API (держите частоту ниже ≈3 запросов в секунду).
- Для точной стоимости Эндо заполните `endo_table` в `config.toml`.
- В отчёте `mods` снижайте/повышайте `live_price_top_n`, если на рынке мало ордеров.
- Утилита только читает публичные данные и не взаимодействует с вашим аккаунтом.
